# Mod Settings Format | Sheltered Mod Manager v1.0

## Location per mod

- `Config/default.json` - Default values bundled with the mod
- `Config/user.json` - User overrides (created when settings change)

## File format

JSON format, parsed by UnityEngine.JsonUtility on .NET 3.5:

```json
{
  "entries": [
    { "key": "difficulty", "type": "string", "value": "Normal" },
    { "key": "maxCount",   "type": "int",    "value": "10" },
    { "key": "spawnRate",  "type": "float",  "value": "1.25" },
    { "key": "enabled",    "type": "bool",   "value": "true" }
  ]
}
```

## Notes

- Types supported: `string`, `int`, `float`, `bool`
- `default.json` contains all defaults for the mod
- `user.json` includes only keys that differ from defaults
- Effective settings = defaults overridden by user values

---

## Using Settings in a Plugin

**Important:** Your plugin must implement both `Initialize()` and `Start()` methods.

```csharp
using ModAPI.Core;
using UnityEngine;

public class MyPlugin : IModPlugin
{
    private IModLogger _log;
    private int _maxCount;
    private bool _enabled;
    
    public void Initialize(IPluginContext ctx)
    {
        _log = ctx.Log;
        
        // Read settings in Initialize (before game starts)
        var settings = ctx.Settings;
        _maxCount = settings.GetInt("maxCount", 5);
        _enabled = settings.GetBool("enabled", true);
        
        _log.Info($"Settings loaded: enabled={_enabled}, maxCount={_maxCount}");
    }
    
    public void Start(IPluginContext ctx)
    {
        if (!_enabled)
        {
            _log.Info("Plugin disabled via settings");
            return;
        }
        
        // Your mod logic here
        _log.Info($"MyPlugin started with maxCount={_maxCount}");
        
        // Attach behaviours under the per-plugin root
        ctx.PluginRoot.AddComponent<MyMonoBehaviour>();
    }
    
    // Example: Modify and save settings at runtime
    public void UpdateSettings(IPluginContext ctx)
    {
        var settings = ctx.Settings;
        settings.SetInt("maxCount", 20);
        settings.SaveUser();  // Writes to Config/user.json
    }
}
```

---

## Settings API

| Method | Description |
|--------|-------------|
| `GetString(key, default)` | Get string value |
| `GetInt(key, default)` | Get int value |
| `GetFloat(key, default)` | Get float value |
| `GetBool(key, default)` | Get bool value |
| `SetString(key, value)` | Set string value |
| `SetInt(key, value)` | Set int value |
| `SetFloat(key, value)` | Set float value |
| `SetBool(key, value)` | Set bool value |
| `SaveUser()` | Write changes to user.json |

---

## Logging Configuration

Logging is controlled by the Manager and written to `SMM/bin/mod_manager.ini` at launch.

- `DevMode=true|false` enables Debug level and all categories when true
- `LogLevel=Debug|Info|Warning|Error|Fatal` sets minimum level
- `LogCategories=General,Loader,Plugin,Assembly,...` selects categories

Example (Manager writes this file automatically at launch):

```ini
# Generated by Manager at launch
DevMode=true
LogLevel=Debug
LogCategories=General,Loader,Plugin,Assembly,Dependency,Performance
```

Plugin authors should prefer `ctx.Log.Info/Warn/Error` from the plugin context to automatically prefix log messages with the mod id.

To time operations:

```csharp
using (MMLog.Measure("ResolveLoadOrder"))
{
    // ... work ...
}
```
